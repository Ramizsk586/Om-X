
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://esm.sh; style-src 'self' 'unsafe-inline'; connect-src 'self' https://esm.sh https://generativelanguage.googleapis.com https://openrouter.ai https://api.groq.com; img-src 'self' data: https: http:;">
  <title>Om-X System</title>
  <link rel="stylesheet" href="../../css/base/reset.css">
  <link rel="stylesheet" href="../../css/base/variables.css">
  <link rel="stylesheet" href="../../css/base/base.css">
  <link rel="stylesheet" href="../../css/layout/system.css">
  <script type="importmap">
  {
    "imports": {
      "@google/genai": "https://esm.sh/@google/genai"
    }
  }
  </script>
  <style>
    /* Modern Update Panel Styles */
    .update-hero-card {
        background: linear-gradient(135deg, rgba(30, 30, 35, 0.9), rgba(20, 20, 25, 0.95));
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 30px;
        position: relative;
        overflow: hidden;
        margin-bottom: 40px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    
    .update-hero-card::before {
        content: '';
        position: absolute;
        top: 0; right: 0;
        width: 300px; height: 300px;
        background: radial-gradient(circle at 50% 50%, var(--accent-color), transparent 70%);
        opacity: 0.1;
        pointer-events: none;
        transform: translate(30%, -30%);
    }

    .hero-content {
        position: relative;
        z-index: 2;
        display: flex;
        align-items: center;
        gap: 24px;
    }

    .hero-icon-box {
        width: 64px;
        height: 64px;
        background: rgba(255,255,255,0.05);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent-color);
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .hero-icon-box svg { width: 32px; height: 32px; }

    .hero-text { flex: 1; }
    
    .hero-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 6px;
        color: #fff;
    }
    
    .hero-subtitle {
        font-size: 13px;
        color: rgba(255,255,255,0.5);
    }

    .hero-actions {
        display: flex;
        gap: 12px;
    }

    .update-progress-container {
        margin-top: 24px;
        background: rgba(255,255,255,0.05);
        height: 6px;
        border-radius: 3px;
        overflow: hidden;
        position: relative;
        display: none; /* Toggled by JS */
    }
    
    .update-progress-fill {
        height: 100%;
        background: var(--accent-color);
        width: 0%;
        transition: width 0.3s ease;
        box-shadow: 0 0 10px var(--accent-color);
    }

    /* Timeline */
    .timeline-header {
        font-size: 14px;
        font-weight: 600;
        color: rgba(255,255,255,0.8);
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .version-timeline {
        position: relative;
        padding-left: 20px;
    }
    
    .version-timeline::before {
        content: '';
        position: absolute;
        left: 0; top: 10px; bottom: 10px;
        width: 2px;
        background: rgba(255,255,255,0.05);
        border-radius: 1px;
    }

    .version-item {
        position: relative;
        padding: 0 0 30px 30px;
    }
    
    .version-item:last-child { padding-bottom: 0; }

    .timeline-marker {
        position: absolute;
        left: -5px;
        top: 0;
        width: 12px;
        height: 12px;
        background: #2b2b33;
        border: 2px solid rgba(255,255,255,0.2);
        border-radius: 50%;
        transition: all 0.3s;
    }
    
    .version-item.current .timeline-marker {
        background: var(--accent-color);
        border-color: var(--accent-color);
        box-shadow: 0 0 0 4px rgba(124, 77, 255, 0.2);
    }

    .version-card {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(255,255,255,0.05);
        border-radius: 12px;
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s;
    }
    
    .version-item:hover .version-card {
        background: rgba(255,255,255,0.05);
    }

    .v-info h4 { font-size: 15px; font-weight: 600; margin-bottom: 4px; color: #fff; }
    .v-meta { font-size: 12px; color: rgba(255,255,255,0.4); font-family: monospace; }
    
    .tag-current {
        background: rgba(124, 77, 255, 0.2);
        color: var(--accent-color);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 700;
        margin-left: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .btn-rollback {
        background: transparent;
        border: 1px solid rgba(255,255,255,0.1);
        color: rgba(255,255,255,0.6);
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-rollback:hover:not(:disabled) {
        border-color: rgba(255,255,255,0.3);
        color: #fff;
        background: rgba(255,255,255,0.05);
    }
    
    .btn-rollback:disabled { opacity: 0; cursor: default; }
  </style>
</head>
<body>
  <div class="system-backdrop"></div>
  
  <div class="system-layout">
    <!-- Sidebar Navigation -->
    <div class="system-sidebar">
      <div class="system-brand">Om-X System</div>
      <div class="nav-menu">
        <button class="sys-nav-item active" data-target="panel-api">API Panel</button>
        <button class="sys-nav-item" data-target="panel-security">Security Suite</button>
        <button class="sys-nav-item" data-target="panel-ai">Omni AI Config</button>
        <button class="sys-nav-item" data-target="panel-search">Search Engine</button>
        <button class="sys-nav-item" data-target="panel-features">Features</button>
        <button class="sys-nav-item" data-target="panel-browser">Browser Settings</button>
        <button class="sys-nav-item" data-target="panel-updates">Updates</button>
        <button class="sys-nav-item" data-target="panel-build">Build & Verify</button>
      </div>
      <div class="sys-footer">
        v1.1.0 Beta
      </div>
    </div>

    <!-- Content Area -->
    <div class="system-content-area">
      
      <div class="system-header-mobile">
        <div id="clock-time" class="clock-time">00:00</div>
      </div>

      <!-- Section 1: API Panel -->
      <div id="panel-api" class="settings-panel active">
        <div class="panel-header">
          <h2>API Connection</h2>
          <p>Configure the brain behind Omni.</p>
        </div>
        
        <div class="settings-form">
          <div class="form-group">
            <label for="provider-select">AI Operator Provider</label>
            <div class="select-wrapper">
              <select id="provider-select">
                <option value="google">Google Gemini</option>
                <option value="openrouter">OpenRouter</option>
                <option value="groq">Groq</option>
              </select>
              <div class="select-arrow">▼</div>
            </div>
          </div>

          <div class="form-group">
            <label for="api-key-input">API Secret Key</label>
            <input type="password" id="api-key-input" placeholder="Paste your API key here..." autocomplete="off">
          </div>

          <div class="form-group">
            <label for="model-select">Target Model</label>
            <div class="select-wrapper">
              <select id="model-select">
                <!-- Populated dynamically -->
              </select>
              <div class="select-arrow">▼</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section: Security Suite -->
      <div id="panel-security" class="settings-panel">
        <div class="panel-header">
          <h2>Security Suite</h2>
          <p>Configure Antivirus, Firewall, and Safety protocols.</p>
        </div>

        <div class="settings-form">
          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">In-Built Antivirus</span>
              <span class="toggle-desc">Scans downloads for malware, suspicious extensions, and double-extension attacks.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-antivirus" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">10-Layer Firewall</span>
              <span class="toggle-desc">Filters network requests, blocks malicious domains, and prevents data exfiltration.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-firewall" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">Ad & Tracker Blocker</span>
              <span class="toggle-desc">Layer 2 defense against malvertising and tracking scripts.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-adblock" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="toggle-group" style="flex-direction: column; align-items: stretch; gap: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div class="toggle-info">
                <span class="toggle-title">AI Safe Search Enforcement</span>
                <span class="toggle-desc">Prioritizes AI verification to filter explicit content. Uses hardcoded rules if AI fails.</span>
              </div>
              <label class="switch">
                <input type="checkbox" id="toggle-safe-search" checked>
                <span class="slider round"></span>
              </label>
            </div>
            <div class="form-group" style="margin-top: 4px;">
                <input type="password" id="safe-search-key" placeholder="Safe Search AI API Key (Optional override)" autocomplete="off" style="font-size: 12px; background: rgba(0,0,0,0.2); border-color: rgba(255,255,255,0.05);">
            </div>
          </div>
        </div>
      </div>

      <!-- Section 2: AI Config -->
      <div id="panel-ai" class="settings-panel">
        <div class="panel-header">
          <h2>Omni Capabilities</h2>
          <p>Grant or revoke permissions for the AI agent.</p>
        </div>

        <div class="settings-form">
          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">Page Vision</span>
              <span class="toggle-desc">Allow Omni to read the text content of the currently active tab.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-vision" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">Web Scraping</span>
              <span class="toggle-desc">Enable extraction of structured data from websites.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-scraping" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">Browser Control</span>
              <span class="toggle-desc">Allow Omni to scroll pages and interact with simple elements.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-control" checked>
              <span class="slider round"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- Section 3: Search Engine Panel -->
      <div id="panel-search" class="settings-panel">
        <div class="panel-header">
          <h2>Search Engine</h2>
          <p>Choose your default search provider.</p>
        </div>
        
        <div id="search-engine-cards" class="search-cards-grid">
          <!-- Cards injected dynamically -->
        </div>

        <div class="panel-section" style="margin-top: 40px;">
          <div class="panel-header">
            <h2>Custom Engines</h2>
            <p>Manage search shortcuts and custom providers.</p>
          </div>
        </div>
      </div>

      <!-- Section 4: Features Panel -->
      <div id="panel-features" class="settings-panel">
        <div class="panel-header">
          <h2>Advanced Features</h2>
          <p>Toggle and configure extra browser capabilities.</p>
        </div>

        <div class="settings-form">
          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">History Tracking</span>
              <span class="toggle-desc">Save browsing history locally. Turning this off hides the History button.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-history" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">Screenshot Studio</span>
              <span class="toggle-desc">Capture webpages and edit them in a built-in image studio.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-screenshot" checked>
              <span class="slider round"></span>
            </label>
          </div>
          
          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">Text Studio (Monaco Engine)</span>
              <span class="toggle-desc">Enable the advanced code editor. Disabling this removes it from the sidebar.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="toggle-text-studio" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="shortcuts-grid">
            <div class="shortcut-row">
              <label>Take Screenshot</label>
              <input type="text" class="shortcut-input" data-action="take-screenshot" value="Ctrl+Shift+S">
            </div>
            <div class="shortcut-row">
              <label>Open Image Studio</label>
              <input type="text" class="shortcut-input" data-action="open-studio" value="Ctrl+Shift+E">
            </div>
            <div class="shortcut-row">
              <label>Open Text Studio</label>
              <input type="text" class="shortcut-input" data-action="open-text-studio" value="Ctrl+Shift+X">
            </div>
          </div>

        </div>
      </div>

      <!-- Section 5: Browser Settings -->
      <div id="panel-browser" class="settings-panel">
        
        <!-- Subsection: Shortcuts -->
        <div class="panel-section">
          <div class="panel-header">
            <h2>General Shortcuts</h2>
            <p>Customize your keyboard commands.</p>
          </div>
          
          <div class="shortcuts-grid">
            <div class="shortcut-row">
              <label>New Tab</label>
              <input type="text" class="shortcut-input" data-action="new-tab" value="Ctrl+T">
            </div>
            <div class="shortcut-row">
              <label>Close Tab</label>
              <input type="text" class="shortcut-input" data-action="close-tab" value="Ctrl+W">
            </div>
            <div class="shortcut-row">
              <label>Toggle Sidebar</label>
              <input type="text" class="shortcut-input" data-action="toggle-sidebar" value="Ctrl+[">
            </div>
            <div class="shortcut-row">
              <label>Omni Chat</label>
              <input type="text" class="shortcut-input" data-action="toggle-ai" value="Ctrl+Space">
            </div>
            <div class="shortcut-row">
              <label>System Page</label>
              <input type="text" class="shortcut-input" data-action="toggle-system" value="Alt+S">
            </div>
             <div class="shortcut-row">
              <label>DevTools</label>
              <input type="text" class="shortcut-input" data-action="toggle-devtools" value="Ctrl+B">
            </div>
            <div class="shortcut-row">
              <label>Toggle Bookmarks</label>
              <input type="text" class="shortcut-input" data-action="toggle-bookmarks" value="Ctrl+Shift+B">
            </div>
          </div>
        </div>

        <!-- Subsection: Search Engines Shortcuts -->
        <div class="panel-section" style="margin-top: 40px;">
          <div class="panel-header">
            <h2>Search Shortcuts</h2>
            <p>Create shortcuts to search specific sites directly.</p>
          </div>

          <div id="search-engines-list" class="shortcuts-grid">
            <!-- Dynamic List -->
          </div>

          <div class="add-engine-form">
            <h3>Add New Shortcut</h3>
            <div class="form-row">
              <input type="text" id="se-name" placeholder="Name (e.g. YouTube)" style="flex: 1;">
              <input type="text" id="se-trigger" placeholder="Key (e.g. Ctrl+Y)" style="width: 120px;">
            </div>
            <div class="form-row">
              <input type="text" id="se-url" placeholder="Search URL (use %s for query)" style="flex: 2;">
              <input type="text" id="se-icon" placeholder="Icon URL (PNG/SVG)" style="flex: 1;">
            </div>
            <button id="btn-add-engine" class="btn-secondary">Add Engine</button>
          </div>
        </div>

        <!-- Subsection: Browser Config -->
        <div class="panel-section" style="margin-top: 40px;">
          <div class="panel-header">
            <h2>Advanced</h2>
          </div>
          
          <div class="toggle-group">
            <div class="toggle-info">
              <span class="toggle-title">Developer Mode</span>
              <span class="toggle-desc">Automatically open DevTools when a new tab starts.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="devtools-toggle">
              <span class="slider round"></span>
            </label>
          </div>
        </div>

      </div>

      <!-- NEW SECTION: Updates Panel -->
      <div id="panel-updates" class="settings-panel">
        <div class="panel-header">
          <h2>Application Updates</h2>
          <p>Manage system versions and stability.</p>
        </div>

        <!-- Hero Status Card -->
        <div class="update-hero-card">
            <div class="hero-content">
                <div class="hero-icon-box" id="update-icon-box">
                    <!-- Check or Cloud Icon -->
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                </div>
                <div class="hero-text">
                    <div class="hero-title" id="update-msg">System is up to date</div>
                    <div class="hero-subtitle">Current Version: <span style="color:#fff; font-family:monospace;">v1.1.0</span></div>
                </div>
                <div class="hero-actions">
                    <button id="btn-check-updates" class="btn-secondary">Check for Updates</button>
                    <button id="btn-download-update" class="btn-primary" style="display:none;">Download</button>
                    <button id="btn-restart-update" class="btn-primary" style="display:none; background:#00e676; color:#000;">Restart Now</button>
                </div>
            </div>
            <div class="update-progress-container" id="update-progress">
                <div class="update-progress-fill" id="update-bar"></div>
            </div>
        </div>

        <div class="panel-section">
           <div class="timeline-header">Version History</div>
           <div id="version-list" class="version-timeline">
              <!-- Injected by JS -->
           </div>
        </div>
      </div>

      <!-- Section 6: Build & Verify -->
      <div id="panel-build" class="settings-panel">
        <div class="panel-header">
          <h2>Build & Verification</h2>
          <p>Diagnostics and Safety Lab.</p>
        </div>

        <div class="settings-form">
          
          <!-- Lab Key Configuration -->
          <div class="panel-section" style="background: rgba(124, 77, 255, 0.05); padding: 20px; border-radius: 12px; border: 1px solid rgba(124, 77, 255, 0.2); margin-bottom: 30px;">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
               <svg viewBox="0 0 24 24" width="20" height="20" fill="#7c4dff"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path d="M7 10h2v7h-2zm4-3h2v10h-2zm4 6h2v4h-2z"/></svg>
               <h3 style="color:white; font-size:15px; font-weight:600;">Lab Environment</h3>
            </div>
            <p style="font-size:13px; color:rgba(255,255,255,0.7); margin-bottom:15px; line-height:1.4;">
              Enter a <strong>separate Gemini API Key</strong> for testing purposes. This key is isolated from your main browser configuration and is used strictly for the diagnostics below.
            </p>
            <div class="form-group">
                <label for="lab-api-key" style="color:#b388ff;">Lab API Key (Gemini Only)</label>
                <input type="password" id="lab-api-key" placeholder="Paste verification key..." autocomplete="off" style="border-color: rgba(124, 77, 255, 0.3);">
            </div>
          </div>

          <!-- API Connectivity -->
          <div class="panel-section">
            <h3 style="color:white; margin-bottom:10px; font-size:14px;">Connectivity Check</h3>
            <p style="font-size:12px; color:rgba(255,255,255,0.5); margin-bottom:15px;">
              Verifies the Lab Key against the Gemini Flash model.
            </p>
            <button id="btn-verify-api" class="btn-secondary" style="width:auto;">Verify Lab Key</button>
            <div id="api-verify-result" style="margin-top:10px; font-size:13px; font-family:monospace; min-height:20px;"></div>
          </div>

          <!-- Safe Search Tester -->
          <div class="panel-section" style="margin-top:30px; border-top:1px solid rgba(255,255,255,0.1); padding-top:20px;">
            <h3 style="color:white; margin-bottom:10px; font-size:14px;">Safety Classifier Simulation</h3>
            <p style="font-size:12px; color:rgba(255,255,255,0.5); margin-bottom:15px;">
              Test how the AI Agent classifies a URL using the Lab Key.
            </p>
            <div class="form-group">
              <label>Target URL</label>
              <input type="text" id="test-url-input" placeholder="e.g. https://example.com" value="https://google.com">
            </div>
            <button id="btn-test-classifier" class="btn-secondary" style="width:auto; margin-top:10px;">Run Classification</button>
            
            <div id="classifier-result" style="margin-top:15px; background:rgba(0,0,0,0.3); padding:15px; border-radius:8px; display:none;">
              <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                 <span style="color:rgba(255,255,255,0.5); font-size:12px;">Classification:</span>
                 <span id="clf-status" style="font-weight:bold;">PENDING</span>
              </div>
              <div id="clf-reason" style="font-size:13px; color:#ddd; white-space:pre-wrap;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions Footer -->
      <div class="actions-footer">
        <button id="btn-save-settings" class="btn-primary">
          Save Changes
        </button>
        <div id="save-status" class="save-status"></div>
      </div>

    </div>
  </div>

  <script type="module" src="../../java/renderer/systemRenderer.js"></script>
</body>
</html>
