

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://esm.sh; style-src 'self' 'unsafe-inline'; connect-src 'self' https://esm.sh https://generativelanguage.googleapis.com; img-src 'self' data: blob: https:;">
  <title>Om-X Studio</title>
  <link rel="stylesheet" href="../../css/base/reset.css">
  <link rel="stylesheet" href="../../css/windows/image-editor.css">
  <script type="importmap">
  {
    "imports": {
      "@google/genai": "https://esm.sh/@google/genai@^0.1.2"
    }
  }
  </script>
</head>
<body>

  <div class="editor-header">
    <div class="brand">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="#7c4dff"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path d="M7 10h10v4H7z"/></svg>
      Om-X Studio
    </div>
    <div class="actions">
      <button id="btn-import" class="btn" title="Import Image">
         <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>
         Import
      </button>
      <button id="btn-undo" class="btn" title="Undo (Ctrl+Z)">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg>
      </button>
      <button id="btn-copy" class="btn">Copy</button>
      <button id="btn-save" class="btn primary">Save</button>
    </div>
  </div>

  <div class="editor-workspace">
    <!-- Tools Sidebar -->
    <div class="sidebar-tools">
      
      <!-- Draw Tools -->
      <div class="tool-group">
        <div class="group-title">Tools</div>
        <div class="tool-grid">
          <button class="tool-btn active" id="tool-cursor" title="Move / View">
            <svg viewBox="0 0 24 24"><path d="M7 2l12 11.2-5.8.5 3.3 7.3-2.2.9-3.2-7.4-4.4 4V2z"/></svg>
          </button>
          <button class="tool-btn" id="tool-select" title="Marquee Selection">
            <svg viewBox="0 0 24 24"><path d="M4 4h2v2H4V4zm4 0h2v2H8V4zm4 0h2v2h-2V4zm4 0h2v2h-2V4zm4 0h2v2h-2V4zm4 0h2v2H8V8zm0 4h2v2H4v-2zm0 4h2v2H4v-2zm0 4h2v2H4v-2zm4 0h2v2H8v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2zm-4-4h2v2h-2v-2zm0-4h2v2h-2V8zm0-4h2v2h-2V4zm4 12h2v2h-2v-2zm0-8h2v2h-2V8zm0-4h2v2h-2V4z" fill="currentColor"/></svg>
          </button>
          <button class="tool-btn" id="tool-lasso" title="Lasso Selection (Freehand)">
            <svg viewBox="0 0 24 24"><path d="M12.63 2.19a.75.75 0 00-.85-.15L4.92 5.37a.75.75 0 00-.39.88l1.37 4.1a.75.75 0 00.94.46l.73-.24c-.2.52-.37 1.05-.5 1.6-.2 1.08-.2 2.14.05 2.94.38 1.17 1.25 1.83 2.58 1.83.67 0 1.34-.17 1.94-.49a5.16 5.16 0 00.5.47c1.3 1.07 2.87 1.38 4.23 1 1.02-.28 1.77-.96 2.22-1.93.44-.98.54-2.14.28-3.4-.24-1.12-.76-2.58-1.57-4.27a.75.75 0 00-.63-.42l-2.07-.12a.75.75 0 00-.7.42l-1.2 2.76c.45.69.75 1.54.84 2.45.1 1.05-.1 1.88-.36 2.37l-.02.04c-.3.57-.8.95-1.46.95-.58 0-1.13-.3-1.63-.84l-.3-.36a2.08 2.08 0 01-.39-1.07c-.12-1.07.2-2.34.8-3.82l.13-.32.07-.18 2.07-5.06-1.55-3zm-1.64 5.9l1.87 4.54c-.58 1.52-.89 2.87-.77 4.04.03.32.1.56.2.7.2.22.37.31.48.31.06 0 .09-.02.1-.04l.01-.03c.12-.22.25-.76.17-1.55-.12-1.2-.55-2.28-1.18-3.15a.75.75 0 00-1.35.6l.04.08z" fill="currentColor"/></svg>
          </button>
          <button class="tool-btn" id="tool-brush" title="Brush">
             <svg viewBox="0 0 24 24"><path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"/></svg>
          </button>
          <button class="tool-btn" id="tool-crop" title="Crop">
             <svg viewBox="0 0 24 24"><path d="M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"/></svg>
          </button>
        </div>
        
        <!-- Contextual Settings -->
        <div id="brush-settings" class="context-settings hidden">
          <div class="slider-control">
            <div class="slider-label"><span>Size</span><span id="brush-size-val">5px</span></div>
            <input type="range" id="brush-size" min="1" max="100" value="5">
          </div>
          <div class="color-picker-row">
             <input type="color" id="brush-color" value="#ff0000">
             <span class="color-label">Color</span>
          </div>
        </div>

        <div id="selection-settings" class="context-settings hidden">
          <div class="group-title">Selection Actions</div>
          <button id="btn-sel-blur" class="btn full-width">Blur Area</button>
          <button id="btn-sel-remove" class="btn full-width" style="margin-top:4px;">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor" style="margin-right:6px;"><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>
            Remove / Cut
          </button>
          <button id="btn-sel-magic-erase" class="btn full-width" style="margin-top:4px; border:1px solid #7c4dff; color:#b388ff;">
             <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor" style="margin-right:6px;"><path d="M7.5 5.6L10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l-1.4 2.5L13.2 14 15.6 15.4 17 18l1.4-2.6L20.8 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zM11 10c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6-6-2.69-6-6z"/></svg>
             Magic Erase
          </button>
        </div>

        <div id="crop-settings" class="context-settings hidden">
           <button id="btn-apply-crop" class="btn primary full-width">Apply Crop</button>
        </div>

      </div>
      
      <!-- AI Tools -->
      <div class="tool-group">
        <div class="group-title">AI Magic</div>
        <button id="btn-ai-remove-bg" class="btn full-width" style="background: rgba(124, 77, 255, 0.15); border: 1px solid rgba(124, 77, 255, 0.3);">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="#7c4dff" style="margin-right:8px;"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6C7.8 12.16 7 10.63 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/></svg>
          Remove Background
        </button>
        <div id="ai-status" class="status-msg hidden">Processing...</div>
      </div>

      <!-- Filters -->
      <div class="tool-group">
        <div class="group-title">Adjustments</div>
        <div class="slider-control">
          <div class="slider-label"><span>Brightness</span><span id="val-brightness">100%</span></div>
          <input type="range" class="filter-slider" data-filter="brightness" min="0" max="200" value="100">
        </div>
        <div class="slider-control">
          <div class="slider-label"><span>Contrast</span><span id="val-contrast">100%</span></div>
          <input type="range" class="filter-slider" data-filter="contrast" min="0" max="200" value="100">
        </div>
        <div class="slider-control">
          <div class="slider-label"><span>Grayscale</span><span id="val-grayscale">0%</span></div>
          <input type="range" class="filter-slider" data-filter="grayscale" min="0" max="100" value="0">
        </div>
        <div class="slider-control">
          <div class="slider-label"><span>Blur</span><span id="val-blur">0px</span></div>
          <input type="range" class="filter-slider" data-filter="blur" min="0" max="20" step="1" value="0">
        </div>
        <button id="btn-reset-filters" class="btn full-width" style="margin-top:8px;">Reset Filters</button>
      </div>

      <!-- Transform -->
      <div class="tool-group">
        <div class="group-title">Transform</div>
        <button id="btn-rotate" class="btn full-width">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="margin-right:8px;"><path d="M7.11 8.53L5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z"/></svg>
          Rotate 90Â°
        </button>
      </div>

    </div>

    <!-- Canvas -->
    <div class="canvas-area" id="canvas-container">
       <canvas id="editor-canvas"></canvas>
    </div>
  </div>

  <script type="module" src="../../java/renderer/imageEditorRenderer.js"></script>
</body>
</html>