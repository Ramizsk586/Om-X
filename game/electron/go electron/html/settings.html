
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Go Settings</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
      body { background: transparent; padding: 40px; overflow-y: auto; font-family: 'Inter', sans-serif; }
      
      h1 { 
          font-size: 28px; margin-bottom: 40px; font-weight: 800;
          background: linear-gradient(to right, var(--accent), #fff); 
          -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
          text-transform: uppercase; letter-spacing: 2px;
      }
      
      .section { margin-bottom: 48px; animation: slideUp 0.5s ease backwards; }
      .section-title { font-size: 14px; font-weight: 700; color: var(--accent); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; }

      .settings-group {
          background: rgba(255,255,255,0.02);
          border: 1px solid rgba(255,255,255,0.08);
          border-radius: 16px;
          overflow: hidden;
      }
      
      .s-row {
          display: flex; justify-content: space-between; align-items: center;
          padding: 20px 24px;
          border-bottom: 1px solid rgba(255,255,255,0.05);
      }
      .s-row:last-child { border-bottom: none; }

      .row-label { font-size: 14px; font-weight: 600; margin-bottom: 4px; color: var(--text-main); }
      .row-desc { font-size: 12px; color: var(--text-muted); }

      /* Theme Grid */
      .theme-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 16px;
          margin-bottom: 32px;
      }
      
      .theme-card {
          background: rgba(255,255,255,0.03);
          border: 1px solid rgba(255,255,255,0.08);
          border-radius: 16px;
          cursor: pointer;
          overflow: hidden;
          transition: all 0.2s ease;
          position: relative;
          display: flex; flex-direction: column;
      }
      
      .theme-card:hover { transform: translateY(-4px); border-color: var(--accent); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
      .theme-card.active { border-color: var(--accent); box-shadow: 0 0 20px var(--accent-glow); background: rgba(255,255,255,0.06); }
      
      .theme-preview {
          height: 80px;
          width: 100%;
          position: relative;
          background: var(--preview-bg);
          display: flex; align-items: center; justify-content: center;
      }
      
      .theme-dot-primary { width: 30px; height: 30px; border-radius: 50%; background: var(--preview-accent); box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 2; }
      .theme-dot-secondary { width: 30px; height: 30px; border-radius: 50%; background: var(--preview-sec); margin-left: -10px; z-index: 1; opacity: 0.8; }
      
      .theme-name {
          padding: 12px;
          text-align: center;
          font-size: 12px;
          font-weight: 700;
          text-transform: uppercase;
          color: var(--text-main);
          border-top: 1px solid rgba(255,255,255,0.05);
      }

      /* Switch */
      .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
      .switch input { opacity: 0; width: 0; height: 0; }
      .slider {
          position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
          background-color: rgba(255,255,255,0.1); transition: .4s; border-radius: 34px;
      }
      .slider:before {
          position: absolute; content: ""; height: 18px; width: 18px;
          left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;
      }
      input:checked + .slider { background-color: var(--accent); }
      input:checked + .slider:before { transform: translateX(20px); }

      /* Log Viewer */
      .log-viewer {
          background: #000;
          border: 1px solid rgba(255,255,255,0.1);
          border-radius: 8px;
          height: 200px;
          overflow-y: auto;
          padding: 10px;
          font-family: 'JetBrains Mono', monospace;
          font-size: 11px;
          color: #ccc;
          margin-bottom: 12px;
          white-space: pre-wrap;
      }
      .log-entry { padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
      .log-time { color: #64748b; margin-right: 8px; }
      .log-ctx { color: var(--accent); font-weight: 700; margin-right: 8px; }
      .log-err { color: #f87171; }

      /* Animation */
      @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

      /* Buttons */
      .btn {
          padding: 10px 20px; border-radius: 8px; border: none; font-weight: 700; font-size: 12px;
          cursor: pointer; transition: all 0.2s; background: var(--accent); color: #fff;
          text-transform: uppercase; letter-spacing: 1px;
      }
      .btn:hover { filter: brightness(1.1); transform: translateY(-2px); }
      .btn-secondary { background: rgba(255,255,255,0.1); color: var(--text-main); }
      .btn-secondary:hover { background: rgba(255,255,255,0.15); }
      .btn-danger { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.3); }
      .btn-danger:hover { background: rgba(239, 68, 68, 0.3); }
  </style>
</head>
<body class="theme-emerald">

  <h1>Configuration</h1>

  <!-- VISUAL IDENTITY -->
  <div class="section" style="animation-delay: 0.1s;">
      <div class="section-title">Visual Identity</div>
      <div class="theme-grid" id="themeSelector">
          <!-- JS Injected -->
      </div>
  </div>

  <!-- PERFORMANCE -->
  <div class="section" style="animation-delay: 0.2s;">
      <div class="section-title">System Performance</div>
      <div class="settings-group">
          <div class="s-row">
              <div>
                  <div class="row-label">Reduced Motion</div>
                  <div class="row-desc">Disable complex animations for better performance.</div>
              </div>
              <label class="switch"><input type="checkbox" id="animToggle"><span class="slider"></span></label>
          </div>
      </div>
  </div>

  <!-- GAME INTERFACE -->
  <div class="section" style="animation-delay: 0.25s;">
      <div class="section-title">Game Interface</div>
      <div class="settings-group">
          <div class="s-row">
              <div>
                  <div class="row-label">Show Coordinates</div>
                  <div class="row-desc">Display letters and numbers on the board edges.</div>
              </div>
              <label class="switch"><input type="checkbox" id="coordsToggle"><span class="slider"></span></label>
          </div>
      </div>
  </div>

  <!-- ANALYSIS -->
  <div class="section" style="animation-delay: 0.3s;">
      <div class="section-title">Analysis Features</div>
      <div class="settings-group">
          <div class="s-row">
              <div>
                  <div class="row-label">Enable Gemini Analysis</div>
                  <div class="row-desc">Get AI-powered insights in the review panel.</div>
              </div>
              <label class="switch"><input type="checkbox" id="geminiAnalysisToggle"><span class="slider"></span></label>
          </div>
          <div class="s-row">
              <div>
                  <div class="row-label">Google Search Grounding</div>
                  <div class="row-desc">Allow Gemini to use Google Search for facts.</div>
              </div>
              <label class="switch"><input type="checkbox" id="groundingToggle"><span class="slider"></span></label>
          </div>
      </div>
  </div>

  <!-- DEBUG -->
  <div class="section" style="animation-delay: 0.35s;">
      <div class="section-title">Debug & Diagnostics</div>
      <div class="settings-group" style="padding:16px;">
          <div class="log-viewer" id="logViewer">Loading logs...</div>
          <div style="display:flex; gap:10px;">
              <button class="btn" id="btnOpenConsole" style="flex:1;">Open Developer Console</button>
              <button class="btn-secondary" id="btnRefreshLogs" style="flex:1;">Refresh</button>
              <button class="btn-danger" id="btnClearLogs" style="flex:0 0 100px;">Clear Logs</button>
          </div>
      </div>
  </div>

  <script>
    const THEMES = [
        { id: 'theme-emerald', name: 'Emerald', bg: '#232730', accent: '#10b981', sec: '#059669' },
        { id: 'theme-classic', name: 'Classic', bg: '#dcb35c', accent: '#d97706', sec: '#b45309' },
        { id: 'theme-serene',  name: 'Serene',  bg: '#1f2937', accent: '#60a5fa', sec: '#3b82f6' },
        { id: 'theme-mono',    name: 'Mono',    bg: '#333',    accent: '#9ca3af', sec: '#4b5563' },
        { id: 'theme-crimson', name: 'Crimson', bg: '#450a0a', accent: '#ef4444', sec: '#991b1b' },
        { id: 'theme-ocean',   name: 'Ocean',   bg: '#0c4a6e', accent: '#06b6d4', sec: '#155e75' },
        { id: 'theme-midnight',name: 'Midnight',bg: '#2e1065', accent: '#d8b4fe', sec: '#581c87' },
        { id: 'theme-cyber',   name: 'Cyber',   bg: '#1a0b2e', accent: '#d946ef', sec: '#22d3ee' },
    ];

    const themeSelector = document.getElementById('themeSelector');
    const coordsToggle = document.getElementById('coordsToggle');
    const animToggle = document.getElementById('animToggle');
    const geminiToggle = document.getElementById('geminiAnalysisToggle');
    const groundingToggle = document.getElementById('groundingToggle');
    const logViewer = document.getElementById('logViewer');

    let currentTheme = 'theme-emerald';

    function renderThemeSwatches() {
        themeSelector.innerHTML = '';
        THEMES.forEach(theme => {
            const card = document.createElement('div');
            card.className = 'theme-card';
            if (theme.id === currentTheme) card.classList.add('active');
            
            card.innerHTML = `
                <div class="theme-preview" style="--preview-bg: ${theme.bg}; --preview-accent: ${theme.accent}; --preview-sec: ${theme.sec}">
                    <div class="theme-dot-primary"></div><div class="theme-dot-secondary"></div>
                </div>
                <div class="theme-name">${theme.name}</div>
            `;
            card.onclick = () => setTheme(theme.id);
            themeSelector.appendChild(card);
        });
    }

    function setTheme(themeId) {
        currentTheme = themeId;
        renderThemeSwatches();
        document.body.className = themeId; // Preview immediately
        window.electronAPI.savePreferences({ goTheme: themeId });
    }

    // Toggles with Auto-Save
    coordsToggle.onchange = () => window.electronAPI.savePreferences({ goShowCoordinates: coordsToggle.checked });
    animToggle.onchange = () => {
        // Toggle UI is "Reduced Motion", pref is "enableAnimations"
        window.electronAPI.savePreferences({ enableAnimations: !animToggle.checked });
    };
    
    geminiToggle.onchange = () => {
        const enabled = geminiToggle.checked;
        groundingToggle.disabled = !enabled;
        if(!enabled) {
            groundingToggle.checked = false;
            window.electronAPI.savePreferences({ goGeminiAnalysisEnabled: false, goGroundingEnabled: false });
        } else {
            window.electronAPI.savePreferences({ goGeminiAnalysisEnabled: true });
        }
    };
    
    groundingToggle.onchange = () => window.electronAPI.savePreferences({ goGroundingEnabled: groundingToggle.checked });

    // Debugging
    document.getElementById('btnOpenConsole').onclick = () => window.electronAPI.openDevTools();
    
    document.getElementById('btnRefreshLogs').onclick = loadLogs;
    document.getElementById('btnClearLogs').onclick = async () => {
        await window.electronAPI.clearSystemLogs();
        loadLogs();
    };

    async function loadLogs() {
        logViewer.innerHTML = "Loading...";
        try {
            const logs = await window.electronAPI.getSystemLogs();
            if (!logs || logs.length === 0) {
                logViewer.innerHTML = "<span style='opacity:0.5'>System healthy. No errors logged.</span>";
                return;
            }
            let html = "";
            logs.forEach(l => {
                const date = new Date(l.timestamp).toLocaleTimeString();
                html += `<div class="log-entry">
                    <span class="log-time">[${date}]</span>
                    <span class="log-ctx">${l.context || 'APP'}</span>
                    <span class="log-err">${l.message}</span>
                </div>`;
            });
            logViewer.innerHTML = html;
        } catch(e) {
            logViewer.innerHTML = "Failed to load logs. (Backend support might be missing in this version)";
        }
    }

    // Init
    (async () => {
        try {
            const prefs = await window.electronAPI.getPreferences();
            if (prefs) {
                currentTheme = prefs.goTheme || 'theme-emerald';
                document.body.className = currentTheme;
                
                coordsToggle.checked = prefs.goShowCoordinates !== false;
                animToggle.checked = prefs.enableAnimations === false; // Checked = Reduced Motion
                geminiToggle.checked = prefs.goGeminiAnalysisEnabled === true;
                groundingToggle.checked = prefs.goGroundingEnabled === true;
                groundingToggle.disabled = !geminiToggle.checked;
                
                renderThemeSwatches();
            }
            loadLogs();
        } catch(e) {
            console.error(e);
        }
    })();
  </script>
</body>
</html>
