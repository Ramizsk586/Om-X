<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>New Game</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #343746, #171821);
      color: #f5f5f5;
      padding: 14px;
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: 18px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      opacity: 0.9;
    }

    .card {
      background: rgba(0,0,0,0.4);
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.06);
    }

    .row {
      margin: 6px 0;
    }

    label {
      font-size: 13px;
    }

    select {
      width: 100%;
      background: #101218;
      color: #eee;
      border-radius: 6px;
      border: 1px solid #333b4a;
      padding: 4px 6px;
      box-sizing: border-box;
      font-size: 13px;
      margin-top: 4px;
    }

    button {
      padding: 6px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      margin-top: 8px;
      background: #3e7ee4;
      color: #fff;
    }

    button:hover {
      filter: brightness(1.1);
    }

    .hint {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <h1>New Game</h1>

  <div class="card">
    <div class="row">
      <label><input type="radio" name="mode" value="human" checked> Human vs Human</label>
    </div>
    <div class="row">
      <label><input type="radio" name="mode" value="engine"> Play vs Engine</label>
    </div>

    <div class="row" id="engineRow" style="display:none;">
      <label>Select engine:</label>
      <select id="engineSelect"></select>
      <div class="hint">Engines are added in the Settings → Engines panel.</div>
    </div>

    <div class="row" id="sideRow" style="display:none;">
      <label>
        <input type="radio" name="side" value="white" checked> You play White
      </label>
      <label style="margin-left: 8px;">
        <input type="radio" name="side" value="black"> You play Black
      </label>
    </div>

    <button id="startBtn">Start</button>
  </div>

  <script>
    const modeRadios = document.querySelectorAll('input[name="mode"]');
    const engineRow = document.getElementById("engineRow");
    const sideRow = document.getElementById("sideRow");
    const engineSelect = document.getElementById("engineSelect");
    const startBtn = document.getElementById("startBtn");

    let engines = [];

    function refreshRows() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const isEngine = mode === "engine";
      engineRow.style.display = isEngine ? "block" : "none";
      sideRow.style.display = isEngine ? "block" : "none";
    }

    modeRadios.forEach(r => r.addEventListener("change", refreshRows));

    startBtn.addEventListener("click", () => {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      let engineId = null;
      let humanColor = "w";

      if (mode === "engine") {
        if (!engines.length) {
          alert("No engines installed. Add engines in Settings → Engines.");
          return;
        }
        engineId = engineSelect.value;

        const sideRadio = document.querySelector('input[name="side"]:checked');
        const side = sideRadio ? sideRadio.value : "white";
        humanColor = side === "black" ? "b" : "w";
      }

      window.electronAPI?.newGameSelected({
        mode,
        engineId,
        humanColor
      });
    });

    window.electronAPI?.enginesGetBasic().then(list => {
      engines = list || [];
      engineSelect.innerHTML = "";
      if (!engines.length) {
        const opt = document.createElement("option");
        opt.textContent = "(no engines installed)";
        opt.value = "";
        engineSelect.appendChild(opt);
      } else {
        engines.forEach(e => {
          const opt = document.createElement("option");
          opt.textContent = e.name;
          opt.value = e.id;
          engineSelect.appendChild(opt);
        });
      }
    });

    refreshRows();
  </script>
</body>
</html>
